<!-- MODAL -->
<div class="modal custom-modal-fade"
     [ngClass]="{ 'show d-block': open }"
     tabindex="-1">

  <div class="modal-dialog modal-dialog-centered custom-modal-dialog" (click)="$event.stopPropagation()">
    <div class="modal-content custom-modal-content">

      <!-- HEADER -->
      <div class="custom-modal-header">
        <h5 class="custom-modal-title">Select {{ title }}</h5>
        <button class="custom-btn-close" (click)="onClose()"></button>
      </div>

      <!-- BODY -->
      <div class="custom-modal-body">
        <form class="custom-form" (submit)="$event.preventDefault()">
          <div class="custom-form-group">
            <div class="form-floating form-floating-outline mb-0 position-relative">

              <!-- SEARCH BAR -->
              <input #modalSearchInput type="text"
                     class="form-control branch-input"
                     [value]="searchText"
                     (input)="onSearchChange($any($event.target).value)"
                     (focus)="dropdownOpen = true"
                     placeholder="{{ title }}"
                     autocomplete="off" />

              <label>
                <i class="ri-search-line"></i>
                {{ title }}
              </label>

              <!-- CARET -->
              <button type="button"
                      class="dropdown-caret-button"
                      (click)="toggleDropdown()">
                <i [ngClass]="dropdownOpen ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
              </button>

            </div>

            <!-- DROPDOWN LIST -->
            <div class="dropdown-panel mt-2" *ngIf="dropdownOpen">
              <div class="dropdown-list">
                <div class="dropdown-item"
                     *ngFor="let opt of filtered"
                     (click)="pickOption(opt)"
                     [class.is-selected]="isSelected(opt)">
                  <div style="flex:1;min-width:0;">
                    <div class="item-name text-sm font-medium truncate">{{ opt.name }}</div>
                    <div *ngIf="opt.code" class="item-meta text-xs text-muted truncate">{{ opt.code }}</div>
                  </div>
                  <i class="ri-check-line text-success" *ngIf="isSelected(opt)"></i>
                </div>

                <div class="dropdown-empty" *ngIf="(filtered?.length || 0) === 0">
                  No {{ title }} found
                </div>
              </div>
            </div>

          </div>
        </form>
      </div>

      <!-- FOOTER -->
      <div class="custom-modal-footer">
        <button class="custom-btn custom-btn-cancel" (click)="onClose()">Cancel</button>
        <button class="custom-btn custom-btn-save" [disabled]="!tempSelected" (click)="onConfirm()">Continue</button>
      </div>

    </div>
  </div>
</div>

<!-- BACKDROP -->
<div *ngIf="open" class="modal-backdrop fade show d-block"></div>

<div class="dropdown-backdrop" *ngIf="dropdownOpen" (click)="dropdownOpen = false"></div>
