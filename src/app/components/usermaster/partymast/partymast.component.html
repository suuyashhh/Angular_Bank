<svg style="display: none">
  <!-- USER -->
  <symbol id="icon-user" viewBox="0 0 24 24">
    <path d="M12 12c2.8 0 5-2.2 5-5s-2.2-5-5-5-5 
    2.2-5 5 2.2 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z" />
  </symbol>

  <!-- Contact -->
  <symbol id="icon-contact-phone" viewBox="0 0 24 24">
    <path d="M3 4h18v16h-18v-16zm2 2v.2l7 4.8 7-4.8v-.2h-14zm14 12v-9l-7 4.7-7-4.7v9h14z" />
  </symbol>

  <!-- HOME -->
  <symbol id="icon-home" viewBox="0 0 24 24">
    <path d="M12 3l9 8h-3v10h-12v-10h-3z" />
  </symbol>

  <!-- ID CARD -->
  <symbol id="icon-id" viewBox="0 0 24 24">
    <path d="M3 4h18v16h-18v-16zm2 3v2h4v-2h-4zm8 0v2h6v-2h-6zm-8 4v2h4v-2h-4zm8 
    0v2h6v-2h-6zm-8 4v2h10v-2h-10z" />
  </symbol>

  <!-- OFFICE -->
  <symbol id="icon-office" viewBox="0 0 24 24">
    <path d="M3 3h18v18h-18v-18zm4 4h2v2h-2v-2zm4 0h2v2h-2v-2zm4 
    0h2v2h-2v-2zm-8 4h2v2h-2v-2zm4 0h2v2h-2v-2zm4 
    0h2v2h-2v-2zm-8 4h10v2h-10v-2z" />
  </symbol>

  <!-- CHECK CIRCLE -->
  <symbol id="icon-check-circle" viewBox="0 0 24 24">
    <path d="M12 2c5.5 0 10 4.5 10 10s-4.5 10-10 
    10-10-4.5-10-10 4.5-10 10-10zm-1 14l7-7-1.4-1.4-5.6 
    5.6-2.6-2.6-1.4 1.4 4 4z" />
  </symbol>

  <!-- CHECK -->
  <symbol id="icon-check" viewBox="0 0 24 24">
    <path d="M20 6l-11 11-5-5 1.4-1.4 3.6 3.6 9.6-9.6z" />
  </symbol>

  <!-- CROSS -->
  <symbol id="icon-cross" viewBox="0 0 24 24">
    <path d="M6 6l12 12m0-12l-12 12" stroke="#000" stroke-width="2" fill="none" stroke-linecap="round" />
  </symbol>
</svg>

<!-- Full-bleed Wizard Page (complete) -->
<main class="w-full px-6 py-8">
  <div class="card wizard-card w-full rounded-2xl overflow-hidden" style="padding-top: 0 !important">
    <div class="card-body mt-1 p-6 md:p-8 w-full min-w-0">
      <!-- HEADER: page path (left) + Edit Names button (right) -->
      <div class="mb-4 flex items-center justify-between">
        <nav class="text-sm text-gray-600" aria-label="Breadcrumb">
          <ol class="flex items-center gap-2">
            <li class="flex items-center gap-2">
              <span class="text-gray-400">/</span>
              <a class="hover:underline" routerLink="/USERMASTER/dashboard">Home</a>
            </li>
            <li class="text-gray-300">/</li>
            <li class="font-semibold text-gray-800">Party Master</li>
          </ol>
        </nav>
        <div *ngIf="currentStep != 1" class="inline-flex items-center gap-3 px-5 py-5"></div>
        <div *ngIf="currentStep == 1">
          <button type="button"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-white border border-gray-200 text-sm font-medium shadow-sm hover:bg-gray-50"
            title="Edit display names" (click)="openEdit()" *ngIf="!isEditMode">
            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
              aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.1 2.1 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
            Edit Names
          </button>
          <button type="button"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-white border border-gray-200 text-sm font-medium shadow-sm hover:bg-gray-50"
            title="Edit display names" (click)="openEdit()" *ngIf="isEditMode">
            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
              aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.1 2.1 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
            New Names
          </button>
        </div>
      </div>
      <!-- /HEADER -->
      <div *ngIf="loading" class="loader-overlay">
        <div class="loader"></div>
      </div>

      <!-- STEP radios (hidden) -->
      <input class="wizard-state" type="radio" name="wizard" id="step-1" checked />
      <input class="wizard-state" type="radio" name="wizard" id="step-2" />
      <input class="wizard-state" type="radio" name="wizard" id="step-3" />
      <input class="wizard-state" type="radio" name="wizard" id="step-4" />
      <input class="wizard-state" type="radio" name="wizard" id="step-5" />
      <input class="wizard-state" type="radio" name="wizard" id="step-6" />

      <!-- Stepper -->
      <div class="wizard-steps my-6 w-full">
        <div
          class="max-w-screen-2xl mx-auto flex items-center justify-center gap-6 md:gap-10 lg:gap-14 w-full px-4 min-w-0">
          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(1)" (click)="tryOpenStep(1)">
            <ng-container [ngSwitch]="getStepIcon(1)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 1 }}</span>
            </ng-container>
          </div>

          <div class="flex-1 h-0.5 bg-gray-200 max-w-[100px]"></div>

          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(2)" (click)="tryOpenStep(2)">
            <ng-container [ngSwitch]="getStepIcon(2)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 2 }}</span>
            </ng-container>
          </div>

          <div class="flex-1 h-0.5 bg-gray-200 max-w-[100px]"></div>

          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(3)" (click)="tryOpenStep(3)">
            <ng-container [ngSwitch]="getStepIcon(3)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 3 }}</span>
            </ng-container>
          </div>

          <div class="flex-1 h-0.5 bg-gray-200 max-w-[100px]"></div>

          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(4)" (click)="tryOpenStep(4)">
            <ng-container [ngSwitch]="getStepIcon(4)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 4 }}</span>
            </ng-container>
          </div>

          <div class="flex-1 h-0.5 bg-gray-200 max-w-[100px]"></div>

          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(5)" (click)="tryOpenStep(5)">
            <ng-container [ngSwitch]="getStepIcon(5)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 5 }}</span>
            </ng-container>
          </div>

          <div class="flex-1 h-0.5 bg-gray-200 max-w-[100px]"></div>

          <div
            class="step w-10 h-10 flex items-center justify-center rounded-full border-2 cursor-pointer transition-all duration-200"
            [ngClass]="getStepClass(6)" (click)="tryOpenStep(6)">
            <ng-container [ngSwitch]="getStepIcon(6)">
              <!-- ACTIVE ICONS -->
              <svg *ngSwitchCase="'user'" class="step-svg">
                <use href="#icon-user" />
              </svg>
              <svg *ngSwitchCase="'contact'" class="step-svg">
                <use href="#icon-contact-phone" />
              </svg>
              <svg *ngSwitchCase="'home'" class="step-svg">
                <use href="#icon-home" />
              </svg>
              <svg *ngSwitchCase="'id'" class="step-svg">
                <use href="#icon-id" />
              </svg>
              <svg *ngSwitchCase="'office'" class="step-svg">
                <use href="#icon-office" />
              </svg>
              <svg *ngSwitchCase="'check-circle'" class="step-svg">
                <use href="#icon-check-circle" />
              </svg>

              <!-- VALID -->
              <svg *ngSwitchCase="'check'" class="step-svg">
                <use href="#icon-check" />
              </svg>

              <!-- INVALID -->
              <svg *ngSwitchCase="'cross'" class="step-svg">
                <use href="#icon-cross" />
              </svg>

              <!-- DEFAULT NUMBER -->
              <span *ngSwitchDefault>{{ 6 }}</span>
            </ng-container>
          </div>
        </div>
      </div>

      <div class="form-floating form-floating-outline mb-4" *ngIf="isEditMode">
        <div class="form-floating form-floating-outline mb-4">
          <input class="form-control invalid-check" [(ngModel)]="searchText" readonly [disabled]="currentStep !== 1"
            (click)="getCustomers()" placeholder="Customer ID" />

          <label for="demo">Customer ID</label>
        </div>

        <app-dropdpwn-modal></app-dropdpwn-modal>
      </div>

      <!-- Panels -->
      <div class="wizard-panels">
        <form [formGroup]="form">
          <!-- STEP 1: Basic Details -->
          <section id="panel-1" class="panel" data-step="1" role="tabpanel" aria-labelledby="step-1">
            <!-- Header -->
            <h4 class="mb-6 text-xl font-semibold text-gray-800">
              Basic Details
            </h4>

            <!-- Form Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
              <!-- A/C Type -->
              <div class="form-group">
                <div class="form-floating form-floating-outline">
                  <select id="basic_accountType" class="form-select invalid-check" [(ngModel)]="accountType"
                    name="accountType" formControlName="AcType" autoTabIndex [tabIndexOrder]="1"
                    (change)="onAccountTypeChange()">
                    <option value="" disabled selected></option>
                    <option *ngFor="let res of accountTypes" [value]="res.code">
                      {{ res.name }}
                    </option>
                  </select>
                  <label for="basic_accountType">
                    <i class="fas fa-credit-card"></i>
                    A/C Type <span class="req-star">*</span>
                  </label>
                </div>
                <small class="text-danger mt-1 block" *ngIf="
                    form.get('AcType')?.invalid && form.get('AcType')?.touched
                  ">
                  Account type is required
                </small>
              </div>

              <!-- PAN Card -->
              <div class="flex-1" [hidden]="isHidden('panCard')">
                <div class="form-group">
                  <div class="form-floating form-floating-outline flex-1" [requiredStar]="getDocRequired('panCard')">
                    <input type="text" id="panNo" formControlName="panNo" class="form-control invalid-check"
                      placeholder=" " validatedInput="pan" panFormat showFieldError [messages]="{
                        required: 'PAN is required',
                        pattern: 'Invalid PAN format (ABCDE1234F)'
                      }" />
                    <label for="panNo">
                      <i class="fas fa-id-card"></i>
                      PAN No
                    </label>
                  </div>
                  <!-- Error will be shown by directive below the form-group -->
                </div>
              </div>

              <!-- Aadhaar Card -->
              <div class="flex-1" [hidden]="isHidden('adharCard')">
                <div class="form-group">
                  <div class="form-floating form-floating-outline flex-1" [requiredStar]="getDocRequired('adharCard')">
                    <input type="text" id="AdharNo" formControlName="AdharNo" class="form-control invalid-check"
                      placeholder=" " validatedInput="aadhaar" aadhaarFormat showFieldError [messages]="{
                        required: 'Aadhaar is required',
                        minlength: 'Must be 12 digits'
                      }" />
                    <label for="AdharNo">
                      <i class="fas fa-fingerprint"></i>
                      Aadhaar No
                    </label>
                  </div>
                </div>
              </div>

              <!-- GST -->
              <div class="flex-1" [hidden]="isHidden('gst')">
                <div class="form-group">
                  <div class="form-floating form-floating-outline flex-1" [requiredStar]="getDocRequired('gst')">
                    <input type="text" id="GSTNo" formControlName="GSTNo" class="form-control invalid-check"
                      placeholder=" " validatedInput="gst" gstFormat showFieldError [messages]="{
                        required: 'GST is required',
                        pattern: 'Invalid GST format (15 characters)'
                      }" />
                    <label for="GSTNo">
                      <i class="fas fa-file-invoice-dollar"></i>
                      GST No
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Name Section -->
            <div class="mb-8">
              <h5 class="text-base font-semibold text-gray-700 mb-4">
                Personal Information
              </h5>

              <div class="flex flex-col sm:flex-row gap-4">
                <!-- Prefix Select -->
                <div class="sm:w-48">
                  <div class="form-group">
                    <div class="form-floating form-floating-outline">
                      <select id="basic_title" class="form-select invalid-check" formControlName="nmprefix" autoTabIndex
                        [tabIndexOrder]="5">
                        <option value="" selected></option>
                        <option *ngFor="let res of PrefixType" [value]="res.prefixtype">
                          {{ res.prefixtype }}
                        </option>
                      </select>
                      <label for="basic_title">
                        <i class="fas fa-user-tag"></i>
                        Title
                      </label>
                    </div>
                    <small class="text-danger mt-1 block" *ngIf="
                        form.get('nmprefix')?.invalid &&
                        form.get('nmprefix')?.touched
                      ">
                      Title is required
                    </small>
                  </div>
                </div>

                <!-- Name Input -->
                <div class="flex-1">
                  <div class="form-group">
                    <div class="form-floating form-floating-outline flex-1" requiredStar="Y">
                      <input type="text" id="basic_name" class="form-control invalid-check" formControlName="name"
                        placeholder=" " appInputValidator="name" showFieldError
                        [messages]="{ required: 'Name is required' }" />
                      <label for="basic_name">
                        <i class="fas fa-user"></i>
                        Full Name
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex items-center justify-between">
              <button type="button" (click)="navigateTo(1)"
                class="inline-flex items-center px-6 py-3 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors font-medium step-shake">
                <i class="fas fa-arrow-left mr-2"></i>
                Previous
              </button>

              <button type="button" (click)="goToStep(2)"
                class="inline-flex items-center px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-purple-500 text-white hover:from-purple-700 hover:to-purple-600 transition-colors font-medium shadow-md hover:shadow-lg step-shake"
                autoTabIndex [tabIndexOrder]="7">
                Next
                <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </section>

          <!-- STEP 2: Contact Details -->
          <section id="panel-2" class="panel" data-step="2" role="tabpanel" aria-labelledby="step-2">
            <h4 class="mb-4 text-lg font-semibold">Contact Details</h4>

            <!-- MAIN SPLIT PANEL -->
            <div class="relative grid grid-cols-1 lg:grid-cols-2 gap-14">
              <!-- Vertical Divider -->
              <div class="hidden lg:block absolute left-1/2 top-0 h-full w-px bg-gray-300 shadow-sm"></div>

              <!-- LEFT - PRIMARY -->
              <div class="pr-6">
                <div class="flex items-center justify-between mb-7">
                  <span class="text-base text-lg font-semibold text-gray-500 tracking-wide">
                    Primary Contact
                  </span>
                </div>

                <div class="space-y-4">
                  <!-- Phone -->
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Phone No" validatedInput="phone"
                      phoneFormat formControlName="phone" autoTabIndex [tabIndexOrder]="13" />
                    <label>Phone No</label>
                    <small class="text-danger mt-1 block" *ngIf="phone.invalid()">
                      Phone number must be 10 digits
                    </small>
                  </div>

                  <!-- Mobile -->
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Mobile No"
                      validatedInput="mobile" mobileFormat formControlName="mobile" autoTabIndex [tabIndexOrder]="14" />
                    <label>Mobile No</label>
                    <small class="text-danger mt-1 block" *ngIf="mobile.invalid()">
                      Mobile must start with 6â€“9 and have 10 digits
                    </small>
                  </div>

                  <!-- Email -->
                  <!-- <div class="form-floating form-floating-outline flex-1">
                    <input type="email" class="form-control invalid-check" placeholder="Email" validatedInput="email"
                      formControlName="EMAIL_ID" />

                    <label>Email</label>

                    <small class="text-danger mt-1 block" *ngIf="email.invalid()">
                      Enter a valid email address
                    </small>
                  </div> -->
                </div>
              </div>

              <!-- RIGHT - ALTERNATE -->
              <div class="pl-6">
                <div class="flex items-center justify-between mb-7">
                  <span class="text-base text-lg font-semibold text-gray-500 tracking-wide">
                    Alternate Contact
                  </span>
                </div>

                <div class="space-y-4">
                  <!-- Phone -->
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Phone No" validatedInput="phone"
                      phoneFormat formControlName="phone1" autoTabIndex [tabIndexOrder]="13" />
                    <label>Phone No</label>
                    <small class="text-danger mt-1 block" *ngIf="phone.invalid()">
                      Phone number must be 10 digits
                    </small>
                  </div>

                  <!-- Mobile -->
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Mobile No"
                      validatedInput="mobile" mobileFormat formControlName="mobile1" autoTabIndex
                      [tabIndexOrder]="14" />
                    <label>Mobile No</label>
                    <small class="text-danger mt-1 block" *ngIf="mobile.invalid()">
                      Mobile must start with 6â€“9 and have 10 digits
                    </small>
                  </div>

                  <!-- Email -->
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="email" class="form-control invalid-check" placeholder="Email" validatedInput="email"
                      formControlName="EMAIL_ID" />

                    <label>Email</label>

                    <small class="text-danger mt-1 block" *ngIf="email.invalid()">
                      Enter a valid email address
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Nav buttons -->
            <div class="mt-6 flex items-center justify-between gap-3">
              <!-- PREVIOUS -->
              <button type="button" (click)="navigateTo(1)"
                class="inline-flex items-center px-5 py-2.5 rounded-lg bg-gray-100 text-gray-800 border">
                Previous
              </button>

              <!-- NEXT -->
              <button type="button" (click)="goToStep(3)" autoTabIndex [tabIndexOrder]="10"
                class="inline-flex items-center px-5 py-2.5 rounded-xl bg-violet-600 text-white">
                Next
              </button>
            </div>
          </section>
          <!-- STEP 3: Address Details -->
          <section id="panel-3" class="panel" data-step="3" role="tabpanel" aria-labelledby="step-3">
            <h4 class="mb-4 text-lg font-semibold">Address Details</h4>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <!-- Permanent Address lines -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_permanent_line1" class="form-control invalid-check"
                  name="permanentAddrLine1" appInputValidator="address" placeholder="Permanent Address"
                  formControlName="ADDR1" autoTabIndex [tabIndexOrder]="8" maxlength="80" />
                <label for="addr_permanent_line1">Permanent Address</label>
              </div>

              <div class="form-floating form-floating-outline mb-4 always-float">
                <input type="text" id="addr_permanent_line2" class="form-control invalid-check"
                  name="permanentAddrLine2" appInputValidator="address" placeholder="Permanent Address II"
                  formControlName="ADDR2" autoTabIndex [tabIndexOrder]="9" maxlength="80" />
                <label for="addr_permanent_line2">Permanent Address II</label>
              </div>

              <div class="form-floating form-floating-outline mb-4 always-float">
                <input type="text" id="addr_permanent_line3" class="form-control invalid-check"
                  name="permanentAddrLine3" appInputValidator="address" placeholder="Permanent Address III"
                  formControlName="ADDR3" autoTabIndex [tabIndexOrder]="10" maxlength="80" />
                <label for="addr_permanent_line3">Permanent Address III</label>
              </div>

              <!-- ðŸ”µ PRIMARY CITY -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_city" class="form-control invalid-check" placeholder="City"
                  [value]="selectedCityName" readonly (click)="picker.openPicker('city', 'primary')"
                  style="cursor: pointer" autoTabIndex [tabIndexOrder]="11" />

                <input type="hidden" name="cityCode" [(ngModel)]="selectedCityCode"
                  [ngModelOptions]="{ standalone: true }" />
                <input type="hidden" name="cityUnicId" [(ngModel)]="selectedCityUnicId"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_city">City</label>
              </div>

              <!-- Primary Country -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_country" class="form-control invalid-check" readonly placeholder="Country"
                  [value]="selectedCountryName" />
                <input type="hidden" name="countryCode" [(ngModel)]="selectedCountryCode"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_country">Country</label>
              </div>

              <!-- Primary State -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_state" class="form-control invalid-check" readonly placeholder="State"
                  [value]="selectedStateName" />
                <input type="hidden" name="stateCode" [(ngModel)]="selectedStateCode"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_state">State</label>
              </div>

              <!-- Primary District -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_district" class="form-control invalid-check" readonly placeholder="District"
                  [value]="selectedDistrictName" />
                <input type="hidden" name="districtCode" [(ngModel)]="selectedDistrictCode"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_district">District</label>
              </div>

              <!-- Primary Taluka -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_taluka" class="form-control invalid-check" readonly placeholder="Taluka"
                  [value]="selectedTalukaName" />
                <input type="hidden" name="talukaCode" [(ngModel)]="selectedTalukaCode"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_taluka">Taluka</label>
              </div>

              <!-- ðŸ”µ PRIMARY AREA -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_area" class="form-control invalid-check" readonly placeholder="Area"
                  [value]="selectedAreaName" (click)="picker.openPicker('area', 'primary')" style="cursor: pointer"
                  autoTabIndex [tabIndexOrder]="12" />
                <input type="hidden" name="areaCode" [(ngModel)]="selectedAreaCode"
                  [ngModelOptions]="{ standalone: true }" />
                <label for="addr_area">Area</label>
              </div>

              <!-- Primary Pincode -->
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" id="addr_pincode" class="form-control invalid-check" placeholder="PinCode"
                  appInputValidator="pincode" [value]="selectedPincode" />
                <input type="hidden" name="pin" [(ngModel)]="selectedPincode" [ngModelOptions]="{ standalone: true }" />
                <label for="addr_pincode">PinCode</label>
              </div>
            </div>

            <!-- Toggle Corr Address -->
            <div class="mt-4 ml-2">
              <label class="inline-flex items-center gap-3">
                <input type="checkbox" id="chk_correspondingAddr" [(ngModel)]="useDifferentCorresponding"
                  name="useDifferentCorresponding" class="w-5 h-5 accent-violet-600 rounded-sm shadow-sm"
                  [ngModelOptions]="{ standalone: true }" autoTabIndex [tabIndexOrder]="15" />
                <span class="text-sm text-gray-700">
                  Do You Want Fill Different Corresponding Address ?
                </span>
              </label>
            </div>

            <!-- ðŸ”µ CORRESPONDING BLOCK -->
            <div *ngIf="useDifferentCorresponding" class="mt-6">
              <hr class="border-0 h-1 rounded bg-gradient-to-r from-violet-600 via-violet-500 to-violet-400 mb-6" />

              <h5 class="mb-4 text-md font-semibold">Corresponding Address</h5>

              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Corresponding Address lines -->
                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="addr_corresponding_line1" class="form-control invalid-check"
                    name="correspondingAddrLine1" appInputValidator="address" placeholder="Corresponding Address"
                    formControlName="CorrAddr1" autoTabIndex [tabIndexOrder]="16" />
                  <label for="addr_corresponding_line1">Corresponding Address</label>
                </div>

                <div class="form-floating form-floating-outline mb-4 always-float">
                  <input type="text" id="addr_corresponding_line2" class="form-control invalid-check"
                    name="correspondingAddrLine2" appInputValidator="address" placeholder="Corresponding Address II"
                    formControlName="CorrAddr2" autoTabIndex [tabIndexOrder]="17" />
                  <label for="addr_corresponding_line2">Corresponding Address II</label>
                </div>

                <div class="form-floating form-floating-outline mb-4 always-float">
                  <input type="text" id="addr_corresponding_line3" class="form-control invalid-check"
                    name="correspondingAddrLine3" appInputValidator="address" placeholder="Corresponding Address III"
                    formControlName="CorrAddr3" autoTabIndex [tabIndexOrder]="18" />
                  <label for="addr_corresponding_line3">Corresponding Address III</label>
                </div>

                <!-- City -->
                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_city" class="form-control invalid-check" readonly placeholder="City"
                    [value]="corrCityName" (click)="picker.openPicker('city', 'corr')" style="cursor: pointer"
                    autoTabIndex [tabIndexOrder]="19" />
                  <input type="hidden" [(ngModel)]="corrSelectedCityCode" name="corrCityCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_city">City</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_country" class="form-control invalid-check" readonly placeholder="Country"
                    [value]="corrCountryName" />
                  <input type="hidden" [(ngModel)]="corrSelectedCountryCode" name="corrCountryCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_country">Country</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_state" class="form-control invalid-check" readonly placeholder="State"
                    [value]="corrStateName" />
                  <input type="hidden" [(ngModel)]="corrSelectedStateCode" name="corrStateCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_state">State</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_district" class="form-control invalid-check" readonly
                    placeholder="District" [value]="corrDistrictName" />
                  <input type="hidden" [(ngModel)]="corrSelectedDistrictCode" name="corrDistrictCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_district">District</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_taluka" class="form-control invalid-check" readonly placeholder="Taluka"
                    [value]="corrTalukaName" />
                  <input type="hidden" [(ngModel)]="corrSelectedTalukaCode" name="corrTalukaCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_taluka">Taluka</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_area" class="form-control invalid-check" readonly placeholder="Area"
                    [value]="corrAreaName" (click)="picker.openPicker('area', 'corr')" style="cursor: pointer"
                    autoTabIndex [tabIndexOrder]="20" />
                  <input type="hidden" [(ngModel)]="corrSelectedAreaCode" name="corrAreaCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="corr_area">Area</label>
                </div>

                <div class="form-floating form-floating-outline mb-4">
                  <input type="text" id="corr_pincode" class="form-control invalid-check" readonly placeholder="Pincode"
                    appInputValidator="pincode" [value]="corrPincode" />
                  <label for="corr_pincode">Pincode</label>
                </div>
              </div>
            </div>

            <!-- Nav buttons -->
            <div class="mt-6 flex items-center justify-between gap-3">
              <!-- PREVIOUS -->
              <button type="button" (click)="navigateTo(2)"
                class="inline-flex items-center px-5 py-2.5 rounded-lg bg-gray-100 text-gray-800 border">
                Previous
              </button>

              <!-- NEXT -->
              <button type="button" (click)="goToStep(4)" autoTabIndex [tabIndexOrder]="21"
                class="inline-flex items-center px-5 py-2.5 rounded-xl bg-violet-600 text-white">
                Next
              </button>
            </div>
          </section>

          <!-- Shared picker modal -->
          <app-picker-modal></app-picker-modal>
          <app-dropdpwn-modal></app-dropdpwn-modal>

          <!-- STEP 4: Personal + Company/Firm conditional content -->
          <section id="panel-4" class="panel" data-step="4" role="tabpanel" aria-labelledby="step-4">
            <div *ngIf="accountType === 0">
              <h4 class="mb-4 text-lg font-semibold">Personal Details</h4>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
                <!-- Religion -->
                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" id="religionCode" class="form-control invalid-check" placeholder="Religion Code"
                    [value]="religionName" readonly (click)="picker.openPicker('religion', 'primary')"
                    style="cursor: pointer" />
                  <input type="hidden" name="religionCode" [(ngModel)]="religionCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="religionCode">Religion</label>
                </div>

                <!-- Cast -->
                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" id="castCode" class="form-control invalid-check" placeholder="Cast Code"
                    [value]="castName" readonly (click)="picker.openPicker('cast', 'primary')"
                    style="cursor: pointer" />
                  <input type="hidden" name="castCode" [(ngModel)]="castCode" [ngModelOptions]="{ standalone: true }" />
                  <label for="castCode">Caste</label>
                </div>

                <!-- Occupation -->
                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" id="occupation" class="form-control invalid-check" placeholder="Occupation"
                    [value]="occupationName" readonly (click)="picker.openPicker('occupation', 'primary')"
                    style="cursor: pointer" />
                  <input type="hidden" name="occupationCode" [(ngModel)]="occupationCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="occupation">Occupation</label>
                </div>

                <div class="flex-1">
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Passport No." passportFormat
                      validatedInput="passport" formControlName="passportno" />

                    <label>Passport No.</label>

                    <small class="text-danger mt-1 block" *ngIf="passport?.invalid?.()">
                      Invalid Passport No (e.g., A1234567)
                    </small>
                  </div>
                </div>

                <div class="flex-1">
                  <div class="form-floating form-floating-outline mb-0 sm:col-span-2">
                    <input type="date" class="form-control invalid-check" id="passportExp"
                      placeholder="Passport Exp.Date" formControlName="passexpdate" />
                    <label for="passportExp">Passport Exp. Date</label>
                  </div>
                </div>
                <div class="flex-1">
                  <div class="form-floating form-floating-outline mb-0 sm:col-span-3">
                    <input type="text" class="form-control invalid-check" id="passportIssueAuth"
                      placeholder="Passport Issue Authority" formControlName="passauth" />
                    <label for="passportIssueAuth">Passport Issue Authority</label>
                  </div>
                </div>

                <div class="flex-1">
                  <div class="form-floating form-floating-outline flex-1">
                    <input type="text" class="form-control invalid-check" placeholder="Election Card No." voteridFormat
                      validatedInput="voterid" formControlName="voteridno" />

                    <label>Election Card No.</label>

                    <small class="text-danger mt-1 block" *ngIf="voterid?.invalid?.()">
                      Invalid Voter ID (e.g., ABC1234567)
                    </small>
                  </div>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="date" class="form-control invalid-check" id="birthDate" placeholder="Birth Date"
                    formControlName="birthdate" />
                  <label for="birthDate">Birth Date</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="number" class="form-control invalid-check" id="age" placeholder="Age" min="0"
                    formControlName="AGE" readonly />
                  <label for="age">Age</label>
                </div>

                <div class="sm:col-span-3">
                  <div class="flex items-center gap-4 py-2">
                    <span class="text-sm font-medium mr-2">Gender :</span>

                    <label class="inline-flex items-center gap-2 text-sm cursor-pointer">
                      <input type="radio" formControlName="SEX" value="M"
                        class="w-4 h-4 text-violet-600 border-gray-300" />
                      <span>Male</span>
                    </label>

                    <label class="inline-flex items-center gap-2 text-sm cursor-pointer">
                      <input type="radio" formControlName="SEX" value="F"
                        class="w-4 h-4 text-violet-600 border-gray-300" />
                      <span>Female</span>
                    </label>

                    <label class="inline-flex items-center gap-2 text-sm cursor-pointer">
                      <input type="radio" formControlName="SEX" value="T"
                        class="w-4 h-4 text-violet-600 border-gray-300" />
                      <span>Transgender</span>
                    </label>

                    <label class="inline-flex items-center gap-2 text-sm cursor-pointer">
                      <input type="radio" formControlName="SEX" value="O"
                        class="w-4 h-4 text-violet-600 border-gray-300" />
                      <span>Other</span>
                    </label>
                  </div>
                </div>

                <!-- Other / Staff (fixed small width) -->
                <div class="sm:col-span-3">
                  <div class="flex items-start gap-4">
                    <div class="w-36 min-w-[9rem]">
                      <div class="form-floating form-floating-outline flex-1 max-w-[140px]">
                        <select id="otherStaffType" class="form-select" [(ngModel)]="otherStaffType"
                          (change)="onOtherStaffTypeChange()" [ngModelOptions]="{ standalone: true }">
                          <option value="O">Other</option>
                          <option value="S">Staff</option>
                        </select>
                        <label for="otherStaffType">Other/Staff</label>
                      </div>
                    </div>

                    <div class="flex-1">
                      <div class="form-floating form-floating-outline flex-1">
                        <input class="form-control invalid-check" type="text" [readonly]="true" [disabled]="
                            otherStaffType === 'O' || isOtherStaffSelected
                          " (click)="loadOtherStaffList()" [value]="otherStaffName?.name || otherStaffName || ''"
                          placeholder="Select Other/Staff" />
                        <label for="otherStaffName">Other/Staff Name</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- COMPANY/FIRM DETAILS: shown only for non-Individual -->
            <div *ngIf="accountType !== 0">
              <h4 class="mb-4 text-lg font-semibold">Company/Firm Details</h4>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="regNo" placeholder="Reg.No."
                    formControlName="COMPREGNO" />
                  <label for="regNo">Reg.No.</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="regDate" placeholder="Reg.Date"
                    formControlName="COMPREGDT" />
                  <label for="regDate">Reg.Date</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="numBranches" placeholder="No.Of Branches"
                    appInputValidator="number" formControlName="COMPBRANCH" />
                  <label for="numBranches">No.Of Branches</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="businessNature"
                    placeholder="Business Nature" formControlName="COMPNATURE" />
                  <label for="businessNature">Business Nature</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="paidUpCapital" placeholder="Paid Up Capital"
                    formControlName="COMPPAIDCAPT" />
                  <label for="paidUpCapital">Paid Up Capital</label>
                </div>

                <div class="form-floating form-floating-outline mb-0">
                  <input type="text" class="form-control invalid-check" id="lastYearTurnover"
                    placeholder="Last Year TurnOver" appInputValidator="number" formControlName="COMPTURNOVER" />
                  <label for="lastYearTurnover">Last Year TurnOver</label>
                </div>

                <div class="form-floating form-floating-outline mb-0 sm:col-span-1">
                  <input type="text" class="form-control invalid-check" id="netWorth" placeholder="Net Worth Rs."
                    appInputValidator="number" formControlName="COMPNETWORTH" />
                  <label for="netWorth">Net Worth Rs.</label>
                </div>

                <div class="form-floating form-floating-outline mb-0 sm:col-span-1">
                  <input type="text" class="form-control invalid-check" id="officerName1" placeholder="Officer Name 1"
                    appInputValidator="Company" formControlName="Propritor1" />
                  <label for="officerName1">Officer Name 1</label>
                </div>

                <div class="form-floating form-floating-outline mb-0 sm:col-span-1">
                  <input type="text" class="form-control invalid-check" id="officerName2" placeholder="Officer Name 2"
                    appInputValidator="company" formControlName="Propritor2" />
                  <label for="officerName2">Officer Name 2</label>
                </div>
              </div>
            </div>

            <div class="mt-6 flex items-center justify-between gap-3">
              <!-- PREVIOUS -->
              <button type="button" (click)="navigateTo(3)"
                class="inline-flex items-center px-5 py-2.5 rounded-lg bg-gray-100 text-gray-800 border">
                Previous
              </button>

              <!-- NEXT -->
              <button type="button" (click)="goToStep(5)"
                class="inline-flex items-center px-5 py-2.5 rounded-xl bg-violet-600 text-white">
                Next
              </button>
            </div>
          </section>

          <!-- STEP 5: Other Details (omitted lengthy bits for brevity) -->
          <section id="panel-5" class="panel" data-step="5" role="tabpanel" aria-labelledby="step-5">
            <div *ngIf="accountType == 0">
              <h4 class="mb-6 text-xl font-semibold text-gray-800">
                Other Details
              </h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Office Name -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officeName" class="form-control invalid-check" placeholder=" "
                      appInputValidator="company" formControlName="officename" />
                    <label for="officeName">
                      <i class="fas fa-building"></i>
                      Office Name
                    </label>
                  </div>
                </div>

                <!-- Office PinCode -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officePin" class="form-control invalid-check" placeholder=" "
                      appInputValidator="pincode" formControlName="OFFICEPIN" />
                    <label for="officePin">
                      <i class="fas fa-mail-bulk"></i>
                      PinCode
                    </label>
                  </div>
                </div>

                <!-- Empty column for layout -->
                <div class="hidden lg:block"></div>

                <!-- Office Address I -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officeAddr1" class="form-control invalid-check" placeholder=" "
                      appInputValidator="address" formControlName="OFFICEADDR1" />
                    <label for="officeAddr1">
                      <i class="fas fa-map-marker-alt"></i>
                      Office Address
                    </label>
                  </div>
                </div>

                <!-- Office Address II -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officeAddr2" class="form-control invalid-check" placeholder=" "
                      appInputValidator="address" formControlName="OFFICEADDR2" />
                    <label for="officeAddr2">
                      <i class="fas fa-map-marker-alt"></i>
                      Office Address II
                    </label>
                  </div>
                </div>

                <!-- Office Address III -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officeAddr3" class="form-control invalid-check" placeholder=" "
                      appInputValidator="address" formControlName="OFFICEADDR3" />
                    <label for="officeAddr3">
                      <i class="fas fa-map-marker-alt"></i>
                      Office Address III
                    </label>
                  </div>
                </div>

                <!-- Office Phone No -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="officePhone" class="form-control invalid-check" placeholder=" "
                      appInputValidator="number" formControlName="OFFICEPHONE" />
                    <label for="officePhone">
                      <i class="fas fa-phone"></i>
                      Office Phone No
                    </label>
                  </div>
                </div>

                <!-- Fax No -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input type="text" id="faxNo" class="form-control invalid-check" placeholder=" "
                      formControlName="OFFICEPHONE1" />
                    <label for="faxNo">
                      <i class="fas fa-fax"></i>
                      Fax No.
                    </label>
                  </div>
                </div>

                <!-- Empty column to maintain grid alignment -->
                <div class="hidden lg:block"></div>
              </div>
            </div>

            <div *ngIf="accountType != 0">
              <h4 class="mb-6 text-xl font-semibold text-gray-800">
                Beneficiary Details
              </h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Customer ID (First dropdown) -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input class="form-control invalid-check" id="customerId1" readonly placeholder="Customer ID"
                      (click)="selectCustomers()" [(ngModel)]="customerText" style="cursor: pointer" />
                    <label for="customerId1">
                      <i class="fas fa-user"></i>
                      Customer ID
                    </label>
                  </div>
                </div>

                <!-- Customer ID (Second dropdown) -->
                <div class="form-group">
                  <div class="form-floating form-floating-outline">
                    <input class="form-control invalid-check" id="customerId2" readonly placeholder="Designation"
                      (click)="selectDesignation()" [(ngModel)]="designationText" style="cursor: pointer" />
                    <label for="customerId2">
                      <i class="fas fa-id-card"></i>
                      Designation
                    </label>
                  </div>
                </div>

                <!-- Empty column for layout -->
                <div class="hidden lg:block"></div>
              </div>

              <!-- Table Section -->
              <div class="mb-8" *ngIf="!loading && selectedCustomerDesignations?.length">
                <div class="table-responsive text-nowrap">
                  <table class="table">
                    <thead class="table-dark" style="--bs-table-bg: #8c57ff !important">
                      <tr>
                        <th class="px-4 py-3 text-white">Sr</th>
                        <th class="px-4 py-3 text-white">Name</th>
                        <th class="px-4 py-3 text-white">Designation</th>
                        <th class="px-4 py-3 text-white">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="
                          let c of selectedCustomerDesignations;
                          let i = index
                        ">
                        <td class="px-4 py-3">{{ i + 1 }}</td>
                        <td class="px-4 py-3">
                          <strong>{{ c.customerName }}</strong>
                        </td>
                        <td class="px-4 py-3">
                          <strong>{{ c.designationName }}</strong>
                        </td>
                        <td class="px-4 py-3">
                          <div class="btn-group btn-group-sm" role="group" style="gap: 6px">
                            <button class="btn btn-danger text-white" title="Delete"
                              (click)="removeCustomerDesignation(i)">
                              <i class="ri-delete-bin-6-line"></i>
                              <span class="d-none d-sm-inline">Remove</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex items-center justify-between">
              <button type="button" (click)="navigateTo(4)"
                class="inline-flex items-center px-6 py-3 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors font-medium step-shake">
                <i class="fas fa-arrow-left mr-2"></i>
                Previous
              </button>

              <button type="button" (click)="goToStep(6)"
                class="inline-flex items-center px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-purple-500 text-white hover:from-purple-700 hover:to-purple-600 transition-colors font-medium shadow-md hover:shadow-lg step-shake">
                Next
                <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </section>

          <!-- STEP 6: KYC Details -->
          <section id="panel-6" class="panel" data-step="6" role="tabpanel" aria-labelledby="step-6">
            <h4 class="mb-4 text-lg font-semibold">KYC Details</h4>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- I.D. Proof -->
              <div class="flex items-center gap-3">
                <input type="checkbox" id="chk_idProof" name="idProofCheck"
                  class="w-5 h-5 accent-violet-600 rounded-sm shadow-sm" formControlName="KycIdProof" />
                <div class="form-floating form-floating-outline flex-1">
                  <input [disabled]="!form.get('KycIdProof')?.value" type="text" id="IDProof"
                    class="form-control invalid-check" placeholder="I.D.Proof" [value]="idproofName" readonly
                    (click)="picker.openPicker('idproof', 'primary')" style="cursor: pointer" />
                  <input type="hidden" name="IDProofCode" [(ngModel)]="idproofCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="IDProof">I.D.Proof</label>
                </div>
              </div>

              <!-- Address Proof -->
              <div class="flex items-center gap-3">
                <input type="checkbox" id="chk_addressProof" name="addressProofCheck"
                  class="w-5 h-5 accent-violet-600 rounded-sm shadow-sm" formControlName="KycAddrProof" />
                <div class="form-floating form-floating-outline flex-1">
                  <input [disabled]="!form.get('KycAddrProof')?.value" type="text" id="AddressProof"
                    class="form-control invalid-check" placeholder="Address Proof" [value]="addrproofName" readonly
                    (click)="picker.openPicker('addrproof', 'primary')" style="cursor: pointer" />
                  <input type="hidden" name="AddpProofCode" [(ngModel)]="addrproofCode"
                    [ngModelOptions]="{ standalone: true }" />
                  <label for="AddressProof">Address Proof</label>
                </div>
              </div>

              <!-- Empty third column -->
              <div class="flex items-center gap-3">
                <!-- Empty space -->
              </div>
            </div>

            <div class="mt-6">
              <hr
                class="border-0 h-1 rounded bg-gradient-to-r from-violet-600 via-violet-500 to-violet-400 shadow-[0_6px_18px_rgba(140,87,255,0.12)] mb-6" />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Photo -->
              <div class="rounded-xl border border-gray-200 p-4">
                <div class="text-sm font-semibold text-gray-800">Photo</div>
                <div class="mt-3">
                  <input type="file" accept="image/*" aria-label="Upload Photo" (change)="onFileChange($event, 'photo')"
                    class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60 file-input"
                    #photoInput data-key="photo" />
                </div>
                <div class="mt-3">
                  <div
                    class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                    (click)="openPreview('photo')" tabindex="0" (keydown.enter)="openPreview('photo')" (keydown.space)="
                      $event.preventDefault(); openPreview('photo')
                    " role="button" aria-label="Preview Photo">
                    <img [src]="previews.photo || ''" *ngIf="previews.photo && isImage(previews.photo)"
                      alt="Photo preview" class="w-full h-full object-contain" />
                    <span class="text-sm font-medium text-gray-400" *ngIf="!previews.photo">Preview</span>
                  </div>
                </div>
              </div>

              <!-- Sign -->
              <div class="rounded-xl border border-gray-200 p-4">
                <div class="text-sm font-semibold text-gray-800">Sign</div>
                <div class="mt-3">
                  <input type="file" accept="image/*" aria-label="Upload Signature"
                    (change)="onFileChange($event, 'sign')"
                    class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60 file-input"
                    #signInput data-key="sign" />
                </div>
                <div class="mt-3">
                  <div
                    class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                    (click)="openPreview('sign')" tabindex="0" (keydown.enter)="openPreview('sign')" (keydown.space)="
                      $event.preventDefault(); openPreview('sign')
                    " role="button" aria-label="Preview Signature">
                    <img [src]="previews.sign || ''" *ngIf="previews.sign && isImage(previews.sign)"
                      alt="Signature preview" class="w-full h-full object-contain" />
                    <span class="text-sm font-medium text-gray-400" *ngIf="!previews.sign">Preview</span>
                  </div>
                </div>
              </div>

              <!-- PAN -->
              <div class="rounded-xl border border-gray-200 p-4">
                <div class="text-sm font-semibold text-gray-800">
                  ID Proof (PAN)
                </div>
                <div class="mt-3">
                  <input type="file" accept="image/*,.pdf" aria-label="Upload PAN"
                    (change)="onFileChange($event, 'pan')"
                    class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60 file-input"
                    #panInput data-key="pan" />
                </div>
                <div class="mt-3">
                  <div
                    class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                    (click)="openPreview('pan')" tabindex="0" (keydown.enter)="openPreview('pan')" (keydown.space)="
                      $event.preventDefault(); openPreview('pan')
                    " role="button" aria-label="Preview PAN">
                    <img [src]="previews.pan || ''" *ngIf="previews.pan && isImage(previews.pan)" alt="PAN preview"
                      class="w-full h-full object-contain" />
                    <div class="flex flex-col items-center gap-1 text-gray-500"
                      *ngIf="previews.pan && !isImage(previews.pan)">
                      <i class="fa-solid fa-file-pdf text-3xl"></i>
                      <span class="text-sm">PDF Document</span>
                    </div>
                    <span class="text-sm font-medium text-gray-400" *ngIf="!previews.pan">Preview</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
              <!-- Aadhaar Front -->
              <div class="rounded-xl border border-gray-200 p-4">
                <div class="text-sm font-semibold text-gray-800">
                  Address Proof (Aadhaar Front)
                </div>
                <div class="mt-3">
                  <input type="file" accept="image/*,.pdf" aria-label="Upload Aadhaar Front"
                    (change)="onFileChange($event, 'aadhaarFront')"
                    class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60 file-input"
                    #aadhaarFrontInput data-key="aadhaarFront" />
                </div>
                <div class="mt-3">
                  <div
                    class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                    (click)="openPreview('aadhaarFront')" tabindex="0" (keydown.enter)="openPreview('aadhaarFront')"
                    (keydown.space)="
                      $event.preventDefault(); openPreview('aadhaarFront')
                    " role="button" aria-label="Preview Aadhaar front">
                    <img [src]="previews.aadhaarFront || ''" *ngIf="
                        previews.aadhaarFront && isImage(previews.aadhaarFront)
                      " alt="Aadhaar front preview" class="w-full h-full object-contain" />
                    <div class="flex flex-col items-center gap-1 text-gray-500" *ngIf="
                        previews.aadhaarFront && !isImage(previews.aadhaarFront)
                      ">
                      <i class="fa-solid fa-file-pdf text-3xl"></i>
                      <span class="text-sm">PDF Document</span>
                    </div>
                    <span class="text-sm font-medium text-gray-400" *ngIf="!previews.aadhaarFront">Preview</span>
                  </div>
                </div>
              </div>

              <!-- Aadhaar Back -->
              <div class="rounded-xl border border-gray-200 p-4">
                <div class="text-sm font-semibold text-gray-800">
                  Address Proof (Aadhaar Back)
                </div>
                <div class="mt-3">
                  <input type="file" accept="image/*,.pdf" aria-label="Upload Aadhaar Back"
                    (change)="onFileChange($event, 'aadhaarBack')"
                    class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60 file-input"
                    #aadhaarBackInput data-key="aadhaarBack" />
                </div>
                <div class="mt-3">
                  <div
                    class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                    (click)="openPreview('aadhaarBack')" tabindex="0" (keydown.enter)="openPreview('aadhaarBack')"
                    (keydown.space)="
                      $event.preventDefault(); openPreview('aadhaarBack')
                    " role="button" aria-label="Preview Aadhaar back">
                    <img [src]="previews.aadhaarBack || ''" *ngIf="
                        previews.aadhaarBack && isImage(previews.aadhaarBack)
                      " alt="Aadhaar back preview" class="w-full h-full object-contain" />
                    <div class="flex flex-col items-center gap-1 text-gray-500" *ngIf="
                        previews.aadhaarBack && !isImage(previews.aadhaarBack)
                      ">
                      <i class="fa-solid fa-file-pdf text-3xl"></i>
                      <span class="text-sm">PDF Document</span>
                    </div>
                    <span class="text-sm font-medium text-gray-400" *ngIf="!previews.aadhaarBack">Preview</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-6 flex items-center justify-between gap-3">
              <label for="step-4"
                class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg bg-gray-100 text-gray-800 border-2 border-gray-200 hover:bg-gray-200 cursor-pointer">Previous</label>
              <button type="submit" class="px-5 py-2.5 rounded-lg bg-violet-600 text-white shadow hover:bg-violet-700"
                (click)="submit()">
                Save
              </button>
            </div>
          </section>
        </form>
      </div>
      <!-- /wizard-panels -->
    </div>
  </div>
</main>

<!-- Preview Modal -->
<div *ngIf="modalOpen" class="fixed inset-0 z-50 flex items-center justify-center" aria-modal="true" role="dialog">
  <div class="absolute inset-0 bg-black/60" (click)="closePreview()" aria-hidden="true"></div>

  <div class="bg-white rounded-xl max-w-[920px] w-full mx-4 overflow-auto z-10" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <div class="flex items-center gap-3">
        <h3 class="text-lg font-semibold">Preview</h3>
        <span class="text-sm text-gray-500" *ngIf="activeKey">{{
          activeKey
          }}</span>
      </div>
      <div class="flex items-center gap-2">
        <button type="button"
          class="inline-flex items-center justify-center w-10 h-10 rounded-md bg-gray-100 hover:bg-gray-200"
          (click)="removeCurrent()" title="Remove this file">
          <i class="fa-solid fa-trash-can"></i>
        </button>
        <button type="button"
          class="inline-flex items-center justify-center w-10 h-10 rounded-md bg-gray-100 hover:bg-gray-200"
          (click)="closePreview()" title="Close">
          <i class="fa-solid fa-x"></i>
        </button>
      </div>
    </div>

    <div class="p-4">
      <ng-container *ngIf="activeKey && previews?.[activeKey]; else noFile">
        <img *ngIf="isImage(previews[activeKey])" [src]="previews[activeKey]" alt="Preview"
          class="mx-auto max-h-[72vh] w-auto rounded" />
        <embed *ngIf="!isImage(previews[activeKey])" [src]="previews[activeKey]" type="application/pdf"
          style="width: 100%; height: 72vh; border-radius: 6px" />
      </ng-container>

      <ng-template #noFile>
        <div class="py-8 text-center text-gray-500">
          No file selected for preview.
        </div>
      </ng-template>
    </div>
  </div>
</div>