<!-- Main Content -->
<main class="max-w-7xl mx-auto px-6 py-8">
  <div class="card wizard-card rounded-2xl overflow-hidden" style="padding-top:0!important;">
    <div class="card-body mt-1 p-6 md:p-8">
      <!-- Wizard radios (hidden) -->
      <input class="wizard-state" type="radio" name="wizard2" id="step-1" checked />
      <input class="wizard-state" type="radio" name="wizard2" id="step-2" />

      <!-- Stepper -->
      <div class="wizard-steps my-1 mb-5" role="tablist" aria-label="Steps">
        <div class="steps flex items-center gap-2 justify-center">
          <label
            class="step w-10 h-10 rounded-full border-2 border-gray-200 bg-gray-50 text-gray-500 grid place-items-center font-bold cursor-pointer transition"
            for="step-1" aria-controls="panel-1"><span>1</span></label>
          <div class="divider h-0.5 flex-1 bg-gray-200 rounded-full max-w-40"></div>
          <label
            class="step w-10 h-10 rounded-full border-2 border-gray-200 bg-gray-50 text-gray-500 grid place-items-center font-bold cursor-pointer transition"
            for="step-2" aria-controls="panel-2"><span>2</span></label>
        </div>
      </div>

      <!-- Panels -->
      <div class="wizard-panels">
        <!-- STEP 1 -->
        <section id="panel-1" class="panel" data-step="1" role="tabpanel" aria-labelledby="step-1">
          <h4 class="mb-4 text-lg font-semibold">Basic Details</h4>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="customerId" placeholder="Customer Id" />
                <label for="customerId">Customer Id</label>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="accountType" placeholder="A/C Type" />
                <label for="accountType">A/C Type</label>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="aadhaarNo" placeholder="Aadhaar Card No" />
                <label for="aadhaarNo">Aadhaar Card No</label>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="panNo" placeholder="Pan Card No" />
                <label for="panNo">Pan Card No</label>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="gstNo" placeholder="GST No" />
                <label for="gstNo">GST No</label>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="form-floating form-floating-outline mb-4">
                <input type="text" class="form-control" id="memberType" placeholder="Member Type" />
                <label for="memberType">Member Type</label>
              </div>
            </div>
          </div>

          <div class="mt-4 flex items-center gap-3">
            <div class="form-floating form-floating-outline flex-1 max-w-[140px]">
              <select id="title" class="form-select">
                <option>Mr</option>
                <option>Mrs</option>
                <option>Other</option>
              </select>
            </div>

            <div class="flex-1">
              <div class="form-floating form-floating-outline flex-1">
                <input type="text" class="form-control" id="widgetName" placeholder="Widget Name" />
                <label for="widgetName">Name</label>
              </div>
            </div>
          </div>

          <div class="mt-6 flex items-center justify-between gap-3">
            <span></span>
            <label for="step-2"
              class="inline-flex items-center justify-center rounded-xl bg-violet-600 px-5 py-2.5 text-white font-medium shadow hover:bg-violet-700 cursor-pointer">
              Next
            </label>
          </div>
        </section>

        <!-- STEP 2 -->
        <section id="panel-2" class="panel" data-step="2" role="tabpanel" aria-labelledby="step-2">
          <!-- KYC Tabs -->
          <div class="kvctabs mt-2">
            <!-- Radios (hidden) -->
            <input type="radio" name="kycTab" id="tab-address" class="kvctab-state" checked />
            <input type="radio" name="kycTab" id="tab-personal" class="kvctab-state" />
            <input type="radio" name="kycTab" id="tab-other" class="kvctab-state" />
            <input type="radio" name="kycTab" id="tab-KYC" class="kvctab-state" />

            <!-- Controls -->
            <div class="kvctab-controls inline-flex gap-2 p-1.5 bg-slate-50 border border-slate-200 rounded-xl mb-3"
              role="tablist" aria-label="KYC Sections">
              <label
                class="kvctab-btn px-3 py-2 rounded-lg font-semibold text-gray-500 cursor-pointer border border-transparent transition"
                for="tab-address" role="tab" aria-controls="tab-panel-address">Address Details</label>
              <label
                class="kvctab-btn px-3 py-2 rounded-lg font-semibold text-gray-500 cursor-pointer border border-transparent transition"
                for="tab-personal" role="tab" aria-controls="tab-panel-personal">Personal Details</label>
              <label
                class="kvctab-btn px-3 py-2 rounded-lg font-semibold text-gray-500 cursor-pointer border border-transparent transition"
                for="tab-other" role="tab" aria-controls="tab-panel-other">Other Details</label>
              <label
                class="kvctab-btn px-3 py-2 rounded-lg font-semibold text-gray-500 cursor-pointer border border-transparent transition"
                for="tab-KYC" role="tab" aria-controls="tab-panel-KYC">KYC Details</label>
            </div>

            <!-- Panels -->
            <div class="kvctab-panels">
              <!-- Address -->
              <div id="tab-panel-address" class="kvctab-panel">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="addrLine1" placeholder="Address Line 1" />
                    <label for="addrLine1">Address Line 1</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="addrLine2" placeholder="Address Line 2" />
                    <label for="addrLine2">Address Line 2</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="city2" placeholder="City" />
                    <label for="city2">City</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="pincode2" placeholder="PinCode" />
                    <label for="pincode2">PinCode</label>
                  </div>
                </div>
              </div>

              <!-- Personal -->
              <div id="tab-panel-personal" class="kvctab-panel">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="firstName" placeholder="First Name" />
                    <label for="firstName">First Name</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="lastName" placeholder="Last Name" />
                    <label for="lastName">Last Name</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="date" class="form-control" id="dob2" placeholder="Date of Birth" />
                    <label for="dob2">Date of Birth</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="mobile2" placeholder="Mobile No" />
                    <label for="mobile2">Mobile No</label>
                  </div>
                </div>
              </div>

              <!-- Other -->
              <div id="tab-panel-other" class="kvctab-panel">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="occupation2" placeholder="Occupation" />
                    <label for="occupation2">Occupation</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="income2" placeholder="Annual Income" />
                    <label for="income2">Annual Income</label>
                  </div>
                </div>
              </div>

              <!-- KYC (fixed: moved inside kvctab-panels as tab-panel-KYC) -->
              <div id="tab-panel-KYC" class="kvctab-panel">
                <div class="rounded-xl border border-gray-200 overflow-hidden bg-white">
                  <div class="flex gap-3 p-3 overflow-x-auto">
                    <!-- Photo -->
                    <div class="min-w-[320px] max-w-[360px] flex-1 rounded-xl border border-gray-200 p-4">
                      <div class="text-sm font-semibold text-gray-800">Photo</div>
                      <div class="mt-3">
                        <input type="file" accept="image/*" aria-label="Upload Photo"
                               (change)="onFileChange($event, 'photo')"
                               class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60"
                               #photoInput data-key="photo">
                      </div>
                      <div class="mt-3">
                        <div class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                             (click)="openPreview('photo')" tabindex="0" (keydown.enter)="openPreview('photo')" (keydown.space)="$event.preventDefault(); openPreview('photo')"
                             role="button" aria-label="Preview Photo">
                          <img [src]="previews.photo || ''" *ngIf="previews.photo && isImage(previews.photo)" alt="Photo preview" class="w-full h-full object-contain"/>
                          <span class="text-sm font-medium text-gray-400" *ngIf="!previews.photo">Preview</span>
                        </div>
                      </div>
                    </div>

                    <!-- Sign -->
                    <div class="min-w-[320px] max-w-[360px] flex-1 rounded-xl border border-gray-200 p-4">
                      <div class="text-sm font-semibold text-gray-800">Sign</div>
                      <div class="mt-3">
                        <input type="file" accept="image/*" aria-label="Upload Signature"
                               (change)="onFileChange($event, 'sign')"
                               class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60"
                               #signInput data-key="sign">
                      </div>
                      <div class="mt-3">
                        <div class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                             (click)="openPreview('sign')" tabindex="0" (keydown.enter)="openPreview('sign')" (keydown.space)="$event.preventDefault(); openPreview('sign')"
                             role="button" aria-label="Preview Signature">
                          <img [src]="previews.sign || ''" *ngIf="previews.sign && isImage(previews.sign)" alt="Signature preview" class="w-full h-full object-contain"/>
                          <span class="text-sm font-medium text-gray-400" *ngIf="!previews.sign">Preview</span>
                        </div>
                      </div>
                    </div>

                    <!-- PAN -->
                    <div class="min-w-[320px] max-w-[360px] flex-1 rounded-xl border border-gray-200 p-4">
                      <div class="text-sm font-semibold text-gray-800">ID Proof (PAN)</div>
                      <div class="mt-3">
                        <input type="file" accept="image/*,.pdf" aria-label="Upload PAN"
                               (change)="onFileChange($event, 'pan')"
                               class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60"
                               #panInput data-key="pan">
                      </div>
                      <div class="mt-3">
                        <div class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                             (click)="openPreview('pan')" tabindex="0" (keydown.enter)="openPreview('pan')" (keydown.space)="$event.preventDefault(); openPreview('pan')"
                             role="button" aria-label="Preview PAN">
                          <img [src]="previews.pan || ''" *ngIf="previews.pan && isImage(previews.pan)" alt="PAN preview" class="w-full h-full object-contain"/>
                          <div class="flex flex-col items-center gap-1 text-gray-500" *ngIf="previews.pan && !isImage(previews.pan)">
                            <i class="fa-solid fa-file-pdf text-3xl"></i>
                            <span class="text-sm">PDF Document</span>
                          </div>
                          <span class="text-sm font-medium text-gray-400" *ngIf="!previews.pan">Preview</span>
                        </div>
                      </div>
                    </div>

                    <!-- Aadhaar Front -->
                    <div class="min-w-[320px] max-w-[360px] flex-1 rounded-xl border border-gray-200 p-4">
                      <div class="text-sm font-semibold text-gray-800">Address Proof (Aadhaar Front)</div>
                      <div class="mt-3">
                        <input type="file" accept="image/*,.pdf" aria-label="Upload Aadhaar Front"
                               (change)="onFileChange($event, 'aadhaarFront')"
                               class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60"
                               #aadhaarFrontInput data-key="aadhaarFront">
                      </div>
                      <div class="mt-3">
                        <div class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                             (click)="openPreview('aadhaarFront')" tabindex="0" (keydown.enter)="openPreview('aadhaarFront')" (keydown.space)="$event.preventDefault(); openPreview('aadhaarFront')"
                             role="button" aria-label="Preview Aadhaar front">
                          <img [src]="previews.aadhaarFront || ''" *ngIf="previews.aadhaarFront && isImage(previews.aadhaarFront)" alt="Aadhaar front preview" class="w-full h-full object-contain"/>
                          <div class="flex flex-col items-center gap-1 text-gray-500" *ngIf="previews.aadhaarFront && !isImage(previews.aadhaarFront)">
                            <i class="fa-solid fa-file-pdf text-3xl"></i>
                            <span class="text-sm">PDF Document</span>
                          </div>
                          <span class="text-sm font-medium text-gray-400" *ngIf="!previews.aadhaarFront">Preview</span>
                        </div>
                      </div>
                    </div>

                    <!-- Aadhaar Back -->
                    <div class="min-w-[320px] max-w-[360px] flex-1 rounded-xl border border-gray-200 p-4">
                      <div class="text-sm font-semibold text-gray-800">Address Proof (Aadhaar Back)</div>
                      <div class="mt-3">
                        <input type="file" accept="image/*,.pdf" aria-label="Upload Aadhaar Back"
                               (change)="onFileChange($event, 'aadhaarBack')"
                               class="w-full rounded-xl border-2 border-dashed border-[#8c57ff]/40 bg-[#8c57ff]/5 px-3 py-3 text-sm outline-none file:mr-3 file:rounded-lg file:border-0 file:bg-[#8c57ff] file:px-3 file:py-2 file:text-white hover:border-[#8c57ff]/60"
                               #aadhaarBackInput data-key="aadhaarBack">
                      </div>
                      <div class="mt-3">
                        <div class="relative grid place-items-center w-full h-56 rounded-xl border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-white overflow-hidden"
                             (click)="openPreview('aadhaarBack')" tabindex="0" (keydown.enter)="openPreview('aadhaarBack')" (keydown.space)="$event.preventDefault(); openPreview('aadhaarBack')"
                             role="button" aria-label="Preview Aadhaar back">
                          <img [src]="previews.aadhaarBack || ''" *ngIf="previews.aadhaarBack && isImage(previews.aadhaarBack)" alt="Aadhaar back preview" class="w-full h-full object-contain"/>
                          <div class="flex flex-col items-center gap-1 text-gray-500" *ngIf="previews.aadhaarBack && !isImage(previews.aadhaarBack)">
                            <i class="fa-solid fa-file-pdf text-3xl"></i>
                            <span class="text-sm">PDF Document</span>
                          </div>
                          <span class="text-sm font-medium text-gray-400" *ngIf="!previews.aadhaarBack">Preview</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- /rounded box -->
              </div> <!-- /tab-panel-KYC -->
            </div> <!-- /kvctab-panels -->
          </div> <!-- /kvctabs -->

          <!-- Actions -->
          <div class="wizard-actions mt-4 flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center">
            <label for="step-1"
              class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg bg-gray-100 text-gray-800 border-2 border-gray-200 hover:bg-gray-200 cursor-pointer">
              Previous
            </label>
            <div class="actions-right flex gap-2">
              <!-- Cancel Images removed per request -->
              <button type="button" class="px-5 py-2.5 rounded-lg bg-violet-600 text-white shadow hover:bg-violet-700">
                Finish
              </button>
            </div>
          </div>
        </section>
      </div> <!-- /wizard-panels -->
    </div>
  </div>
</main>

<!-- Preview Modal -->
<div *ngIf="modalOpen" class="fixed inset-0 z-50 flex items-center justify-center" aria-modal="true" role="dialog">
  <div class="absolute inset-0 bg-black/60" (click)="closePreview()" aria-hidden="true"></div>

  <div class="bg-white rounded-xl max-w-[920px] w-full mx-4 overflow-auto z-10" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <div class="flex items-center gap-3">
        <h3 class="text-lg font-semibold">Preview</h3>
        <span class="text-sm text-gray-500" *ngIf="activeKey">{{ activeKey }}</span>
      </div>
      <div class="flex items-center gap-2">
        <button type="button" class="inline-flex items-center justify-center w-10 h-10 rounded-md bg-gray-100 hover:bg-gray-200" (click)="removeCurrent()" title="Remove this file">
          <i class="fa-solid fa-trash-can"></i>
        </button>
        <button type="button" class="inline-flex items-center justify-center w-10 h-10 rounded-md bg-gray-100 hover:bg-gray-200" (click)="closePreview()" title="Close">
          <i class="fa-solid fa-x"></i>
        </button>
      </div>
    </div>

    <div class="p-4">
      <ng-container *ngIf="activeKey && previews?.[activeKey]; else noFile">
        <img *ngIf="isImage(previews[activeKey])" [src]="previews[activeKey]" alt="Preview" class="mx-auto max-h-[72vh] w-auto rounded" />
        <embed *ngIf="!isImage(previews[activeKey])" [src]="previews[activeKey]" type="application/pdf" style="width:100%;height:72vh;border-radius:6px" />
      </ng-container>

      <ng-template #noFile>
        <div class="py-8 text-center text-gray-500">
          No file selected for preview.
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Minimal CSS only for “checked → target” cases Tailwind can't express elegantly -->
<style>
  /* No page scroll inside the card */
  .wizard-card { max-height: calc(100vh - 48px); }

  /* Hide control radios */
  .wizard-state, .kvctab-state { position: absolute; opacity: 0; pointer-events: none; }

  /* Show only the active wizard panel */
  .wizard-panels .panel { display: none; }
  #step-1:checked ~ .wizard-panels #panel-1 { display: block; }
  #step-2:checked ~ .wizard-panels #panel-2 { display: block; }

  /* Step active styles */
  #step-1:checked ~ .wizard-steps label[for="step-1"],
  #step-2:checked ~ .wizard-steps label[for="step-2"] {
    background: linear-gradient(135deg, #8c57ff 0%, #a855f7 100%);
    color: #fff; border-color: transparent; box-shadow: 0 6px 18px rgba(140,87,255,.25);
    transform: translateY(-1px);
  }
  #step-2:checked ~ .wizard-steps label[for="step-1"] {
    background: #f3edff; color: #8c57ff; border-color: #8c57ff;
  }

  /* Tabs: show only the active tab panel */
  .kvctab-panels .kvctab-panel { display: none; padding: 8px 0 2px; }
  #tab-address:checked ~ .kvctab-panels #tab-panel-address { display: block; }
  #tab-personal:checked ~ .kvctab-panels #tab-panel-personal { display: block; }
  #tab-other:checked   ~ .kvctab-panels #tab-panel-other   { display: block; }
  #tab-KYC:checked     ~ .kvctab-panels #tab-panel-KYC     { display: block; }

  /* Tabs: active label look */
  #tab-address:checked ~ .kvctab-controls label[for="tab-address"],
  #tab-personal:checked ~ .kvctab-controls label[for="tab-personal"],
  #tab-other:checked ~ .kvctab-controls label[for="tab-other"],
  #tab-KYC:checked ~ .kvctab-controls label[for="tab-KYC"]{
    background:#f3edff; color:#8c57ff; border-color:#8c57ff;
  }
</style>
