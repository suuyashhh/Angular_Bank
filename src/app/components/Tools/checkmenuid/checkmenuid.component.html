<main class="w-full px-6 py-8">
  <div class="card wizard-card w-full rounded-2xl overflow-hidden" style="padding-top:0!important;">
    <div class="card-body mt-1 p-6 md:p-8 w-full min-w-0">

     
      <!-- TREE VIEW -->
      <div class="mt-4">

        <div *ngIf="loadingMenus" class="flex justify-center py-10">
          <div class="flex flex-col items-center gap-2 text-gray-500 text-sm">
            <div class="spinner-border animate-spin inline-block w-6 h-6 border-4 rounded-full border-violet-500 border-t-transparent"></div>
            <span>Loading menu structure...</span>
          </div>
        </div>

        <div *ngIf="!loadingMenus"
          class="border border-gray-200 rounded-2xl bg-white shadow-sm max-h-[450px] overflow-auto p-4">

          <ng-container *ngIf="menuTree && menuTree.length > 0; else noMenuData">
            <ul class="space-y-1">
              <ng-container *ngFor="let node of menuTree">
                <ng-template [ngTemplateOutlet]="treeNodeTemplate"
                  [ngTemplateOutletContext]="{ node: node }"></ng-template>
              </ng-container>
            </ul>
          </ng-container>

          <ng-template #noMenuData>
            <div class="py-10 text-center text-gray-500 text-sm">
              No menu data found for this programme.
            </div>
          </ng-template>

        </div>
      </div>

      <!-- RECURSIVE NODE TEMPLATE -->
      <ng-template #treeNodeTemplate let-node="node">
        <li class="flex flex-col">
          <div class="flex items-center gap-2 py-0.5">

            <!-- expand collapse -->
            <button *ngIf="node.children && node.children.length > 0"
              type="button"
              class="w-5 h-5 flex items-center justify-center text-xs border border-gray-300 rounded bg-gray-50 hover:bg-gray-100"
              (click)="toggleExpand(node)">
              <span *ngIf="node.expanded">âˆ’</span>
              <span *ngIf="!node.expanded">+</span>
            </button>
            <span *ngIf="!node.children || node.children.length === 0" class="w-5"></span>

            <!-- checkbox -->
            <input type="checkbox" class="w-5 h-5 accent-violet-600 rounded-sm shadow-sm"
              [checked]="node.checked"
              (change)="toggleCheck(node, $any($event.target).checked)" />

            <!-- LABEL + MENU ID -->
            <span class="text-sm text-gray-800 flex items-center gap-2" title="Menu ID: {{ node.id }}">
              <span>{{ node.name }}</span>
              <span class="text-xs text-gray-400">({{ node.id }})</span>
            </span>

          </div>

          <!-- children -->
          <ul *ngIf="node.children && node.children.length > 0 && node.expanded"
            class="pl-6 mt-1 space-y-1">
            <ng-container *ngFor="let child of node.children">
              <ng-template [ngTemplateOutlet]="treeNodeTemplate"
                [ngTemplateOutletContext]="{ node: child }"></ng-template>
            </ng-container>
          </ul>

        </li>
      </ng-template>

    </div>
  </div>
</main>
